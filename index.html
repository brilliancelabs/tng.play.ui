<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
	<meta name="description" content="">
	<meta name="author" content="">
	<link rel="shortcut icon" href="favicon.ico">

	<title>TalknGolf Tracker</title>

	<!-- Bootstrap core CSS -->
	<link href="css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom styles for this template -->
	<link href="css/talkngolf.css" rel="stylesheet">

	<style type="text/css">
		.subhead {
			color: #555;
		}
		.sub-heading {
			font-size: 2em !important;
			line-height: 0.5em;
			color: midnightblue;
		}
		.mood-thumbs {
			color: midnightblue;
		}
		.go-back {
			font-size: 75%;
			color: #777;
		}

	</style>
</head>

<!--CONTENT-->
<body data-ng-app="TnG">
<span data-ng-view=""></span>

<script src="lib/jquery/jquery-1.10.2.js"></script>
<script src="lib/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="lib/angular/1.2.14/angular.min.js"></script>
<script src="lib/angular/1.2.14/angular-route.min.js"></script>
<script src="lib/angular/1.2.14/angular-touch.min.js"></script>
<script src="lib/angular/1.2.14/angular-animate.min.js"></script>
<script src="lib/angular/1.2.14/gestures.min.js"></script>
<script src="lib/firebase/0.0.0/firebase.js"></script>
<script src="lib/angular/1.2.14/angularfire.min.js"></script>

<link href="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">

<script>
	'use strict';

	angular.module('TnG', ['ngRoute', 'ngAnimate', 'ngTouch', 'angular-gestures', 'firebase'])

	.controller('Demo', function ($scope, $location, $route, $firebase, $window) {
		var ctrl = this,
		loadValue,
		loadNextShot,
		loadNextHole,
		loadPhase;

		var refUrl = 'https://tng-rounds.firebaseio.com/demo';
		var demoRef = new Firebase(refUrl);
		var ref = demoRef.child('deezy');


		var appPhases = {
			"1": {"url": "play", "partial": "app/views/9p/starting_hole.angv", "name": "Starting Hole"}
		};

		var current,
		currentHolesPar,
		currentPath,
		newPath,
		newPathArr,
		startingShot;

		current = $route.current.params;
		$scope.currentHole = current.hole || 0;
		$scope.currentShot = current.shot || 0;
		$scope.currentClub = current.club || null;
		$scope.activePane = 1;

		$scope.load2Cell = function () {
			$location.path('2cell');
		}

		$scope.load4Cell = function () {
			$location.path('4cell');
		}

		$scope.load8Cell = function () {
			$location.path('8cell');
		}

		$scope.loadNCell = function () {
			$location.path('nCell');
		}

		loadPhase = function (phaseToLoad) {
			currentHolesPar = arguments[1];
			newPath = appPhases[phaseToLoad].url;
			startingShot = "1";

			newPathArr = [];
			newPathArr.push(newPath);
			newPathArr.push(current.hole);
			newPathArr.push(startingShot);

			newPath = newPathArr.join('/');

			//Save course data to Firebase
			var holeInfo = {};
			holeInfo['par'] = currentHolesPar;
			holeInfo['score'] = "0";

			ref.child(current.hole).set(holeInfo);

			$location.path(newPath);

		}

		loadValue = function (valueToLoad, valueToPassIn) {
			currentPath = newPath = $location.path();

			if(valueToLoad && valueToPassIn) {
				newPath = currentPath + "/" + valueToLoad + "/" + valueToPassIn;

			} else if (valueToLoad) {
				newPath = currentPath + "/" + valueToLoad;

			}
			alert(newPath);
			$location.path(newPath);

		}

		//Custom button functions
		var chosenHole;
		angular.element('[data-choose-hole]').on('click', function () {
			chosenHole = angular.element(this).data().chooseHole;

			$window.location = "#" + $location.path() + "/" + chosenHole + "/par";
		});

		var chosenPar;
		angular.element('[data-choose-par]').on('click', function () {
			chosenPar = angular.element(this).data().choosePar;
			ref.child(current.hole).set({"par": chosenPar});

			$window.location = "#/play/" + current.hole + "/1";
		});

		var chosenClub;
		angular.element('[data-choose-club]').on('click', function () {
			chosenClub = angular.element(this).data().chooseClub;

			$window.location = "#" + $location.path() + "/" + chosenClub;
		});

		var chosenMood;
		angular.element('[data-choose-mood]').on('click', function () {
			chosenMood = angular.element(this).data().chooseMood;

			$window.location = "#" + $location.path() + "/" + chosenMood;
		});

		var chosenAction,
		currentHoleNumber,
		currentShotNumber,
		nextHole,
		nextHoleNumber,
		nextShot,
		nextShotNumber,
		roundState;

		angular.element('[data-choose-next]').on('click', function () {
			chosenAction = angular.element(this).data().chooseNext;
			roundState  = $location.path().split('/');
			roundState.pop(); //play mode
			roundState.pop(); //current club
			currentShotNumber = parseInt(roundState.pop());
			currentHoleNumber = parseInt(roundState.pop());

			if(chosenAction === 'shot') {
				nextShotNumber = currentShotNumber + 1;
				roundState.push(currentHoleNumber);
				roundState.push(nextShotNumber);
				nextShot = roundState.join('/');

				$window.location = "#"+nextShot;
			}

			if(chosenAction === 'hole') {
				nextHoleNumber = currentHoleNumber + 1;
				roundState.push(nextHoleNumber);
				nextHole = roundState.join('/');

				$window.location = "#"+nextHole;
			}
		});

		$scope.goBack = function () {
			history.back();
			if(!$scope.$$phase) {
				$scope.$apply();
			}
		}


	})
	.config(function ($routeProvider) {
		$routeProvider
		.when('/', {
			redirectTo: "/play"
		})
		.when('/play', {
			controller: "Demo",
			templateUrl: "app/views/9p/starting_hole.angv"
		})
		.when('/play/:hole/par', {
			controller: "Demo",
			templateUrl: "app/views/9p/par.angv"
		})
		.when('/play/:hole/:shot', {
			controller: "Demo",
			templateUrl: "app/views/9p/club.angv"
		})
		.when('/play/:hole/:shot/:club', {
			controller: "Demo",
			templateUrl: "app/views/9p/mood_thumbs.angv"
		})
		.when('/play/:hole/:shot/:club/:mood', {
			controller: "Demo",
			templateUrl: "app/views/9p/next.angv"
		})
	});
</script>

</body>
</html>